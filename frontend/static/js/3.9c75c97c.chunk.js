(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[3],{107:function(e,t,a){"use strict";a.r(t);var n=a(32),r=a(22),c=a(16),i=a.n(c),o=a(33),s=a(17),l=a(20),m=a(11),u=a(12),p=a(14),f=a(13),d=a(0),_=a.n(d),h=a(36),b=a(5),v=a(18),k=a(76),E=a(26),j=(a(90),a(55),a(56),a(21)),g=a(35),O=a(23),N={0:1,1:0,2:3,3:2},y=a(91),w=a.n(y),x=a(92),S=a.n(x),I=a(93),P=a.n(I),C=a(94),L=a.n(C),T=a(31),A=a(4),F=[w.a,L.a,P.a,S.a],M=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(m.a)(this,a);for(var n=arguments.length,c=new Array(n),u=0;u<n;u++)c[u]=arguments[u];return(e=t.call.apply(t,[this].concat(c))).state={posts:[],profileInfo:{},offset:0},e.myId=+Object(O.a)("userId"),e.postsFetchLimit=10,e.relationButtonClickedHandler=Object(l.a)(i.a.mark((function t(){var a,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(E.a)(A.b+A.a+"/relations/update_relationship",{userId:e.props.match.params.id,prevRelType:e.state.profileInfo.rel},"POST","text");case 2:a=t.sent,n=Object(s.a)(a,1),null===n[0]&&((r=Object(o.a)({},e.state.profileInfo)).rel=N[r.rel],e.setState({profileInfo:r}));case 6:case"end":return t.stop()}}),t)}))),e.handleScrollThrottled=Object(T.a)((function(){Math.abs(window.scrollY+window.innerHeight-document.documentElement.scrollHeight)<10&&!e.state.Done&&!e.state.popupOpen&&!e.state.isFetching&&e.fetchPosts()}),1e3),e.fetchProfileInfo=Object(l.a)(i.a.mark((function t(){var a,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(E.a)(A.b+A.a+"/profile/page_info",{userId:e.props.match.params.id});case 2:a=t.sent,n=Object(s.a)(a,2),r=n[1],e.setState({profileInfo:r||{}});case 6:case"end":return t.stop()}}),t)}))),e.fetchPosts=Object(l.a)(i.a.mark((function t(){var a,n,c,o,l,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.state.offset,n={userId:e.props.match.params.id,offset:a,limit:e.postsFetchLimit},e.setState((function(){return{isFetching:!0}})),t.next=5,Object(E.a)(A.b+A.a+"/profile/get_posts",n);case 5:c=t.sent,o=Object(s.a)(c,2),l=o[0],m=o[1],null===l?e.setState((function(t){return{offset:a+e.postsFetchLimit,posts:[].concat(Object(r.a)(t.posts),Object(r.a)(m.Posts)),Done:m.Done}})):console.log(l),e.setState({isFetching:!1});case 11:case"end":return t.stop()}}),t)}))),e.componentDidMount=function(){window.addEventListener("scroll",e.handleScrollThrottled,!0),e.fetchProfileInfo(),e.fetchPosts()},e.componentDidUpdate=function(){var t=Object(l.a)(i.a.mark((function t(a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.match.params.id!==a.match.params.id&&e.setState({posts:[],profileInfo:{},offset:0},(function(){e.fetchProfileInfo(),e.fetchPosts()}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.addNewPost=function(){var t=Object(l.a)(i.a.mark((function t(a){var n,c,o,l,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(E.a)(A.b+A.a+"/profile/add_new_object",{text:a},"POST","json");case 2:n=t.sent,c=Object(s.a)(n,2),o=c[0],l=c[1],null===o&&(m={text:a,auth_id:e.myId,path:l.path,num_likes:0,creation_time:"\u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e",modification_time:null,first_name:"Vladimir",last_name:"Putin",num_comments:0,me_liked:!1},e.setState((function(e){return{posts:[m].concat(Object(r.a)(e.posts)),offset:e.offset+1}})));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.postNewLikeState=function(){var e=Object(l.a)(i.a.mark((function e(t,a){var n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)(A.b+A.a+"/profile/update_like",{meLiked:t,path:a},"POST","text");case 2:return n=e.sent,r=Object(s.a)(n,1),c=r[0],e.abrupt("return",null===c);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),e.deletePost=function(t){e.setState((function(e){return{posts:e.posts.filter((function(e){return e.path!==t})),offset:e.offset-1}}))},e.updatePostLike=new g.a(function(){var t=Object(l.a)(i.a.mark((function t(a,n){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.postNewLikeState(a,n);case 2:if(!t.sent){t.next=5;break}r=e.state.posts.map((function(e){return e.path===n&&(e.num_likes+=e.me_liked?-1:1,e.me_liked=!e.me_liked),e})),e.setState({posts:r});case 5:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),100),e}return Object(u.a)(a,[{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScrollThrottled)}},{key:"render",value:function(){var e=this;return _.a.createElement("div",{className:"page__container"},_.a.createElement("div",{className:"profile__header_pics"},_.a.createElement("img",{className:"default_img profile__bg_pic",src:A.b+A.a+"/profile_bgs".concat(Object(j.a)(this.props.match.params.id),"/profile_bg.jpg"),alt:""}),_.a.createElement("img",{className:"default_img avatar profile__avatar",src:A.b+A.a+"/profile_bgs".concat(Object(j.a)(this.props.match.params.id),"/profile_avatar.jpg"),alt:""})),_.a.createElement("div",{className:"navigator"},_.a.createElement("div",{className:"navigator__item"},_.a.createElement(b.c,{to:"/about_me/".concat(this.props.match.params.id)},"\u041e\u0431\u043e \u043c\u043d\u0435")),_.a.createElement("div",{className:"navigator__item"},_.a.createElement(b.c,{to:"/\u0441\u0432\u044f\u0437\u0438/".concat(this.props.match.params.id,"/\u0434\u0440\u0443\u0437\u044c\u044f")},"\u041c\u043e\u0438 \u0434\u0440\u0443\u0437\u044c\u044f")),_.a.createElement("div",{className:"navigator__item"},_.a.createElement(b.c,{to:"/\u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438/".concat(this.props.match.params.id)},"\u041c\u043e\u0438 \u0444\u043e\u0442\u043e")),_.a.createElement("div",{className:"navigator__item profile__descr"},_.a.createElement("p",{className:"profile_name"},"".concat(this.state.profileInfo.first_name," ").concat(this.state.profileInfo.last_name)),_.a.createElement("p",{className:"profile_country"},this.state.profileInfo.country)),_.a.createElement("div",{className:"navigator__item"},_.a.createElement(b.c,{to:"/\u043c\u0443\u0437\u044b\u043a\u0430/".concat(this.props.match.params.id)},"\u041c\u043e\u044f \u043c\u0443\u0437\u044b\u043a\u0430")),_.a.createElement("div",{className:"navigator__item"},_.a.createElement(b.c,{to:"/\u0432\u0438\u0434\u0435\u043e/".concat(this.props.match.params.id)},"\u041c\u043e\u0438 \u0432\u0438\u0434\u0435\u043e")),_.a.createElement("div",{className:"navigator__item"},_.a.createElement("div",{className:"navigator__functional"},_.a.createElement(b.c,{to:{pathname:"/\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f/",user_id:this.props.match.params.id,first_name:this.state.profileInfo.first_name,last_name:this.state.profileInfo.last_name}},_.a.createElement("div",{className:"default_img open_conversation_img navigator__functional_item"})),_.a.createElement("button",{type:"button",className:"default_img relations_with_me__button navigator__functional_item",onClick:this.relationButtonClickedHandler,style:{backgroundImage:"url(".concat(F[this.state.profileInfo.rel],")"),display:"".concat(void 0===this.state.profileInfo.rel?"none":"block")}})))),_.a.createElement("div",{className:"profile_info__container"},_.a.createElement("div",{className:"profile__sidebar__left"},_.a.createElement("div",{className:"default_block"},_.a.createElement("h1",{className:"default_block__header"},"\u041a\u0440\u0430\u0442\u043a\u043e \u043e\u0431\u043e \u043c\u043d\u0435"),_.a.createElement("div",{className:"default_block__item"},_.a.createElement("h2",null,"\u0413\u043e\u0440\u043e\u0434 \u043f\u0440\u043e\u0436\u0438\u0432\u0430\u043d\u0438\u044f:"),_.a.createElement("p",null,this.state.profileInfo.city||"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e")),_.a.createElement("div",{className:"default_block__item"},_.a.createElement("h2",null,"\u0414\u0435\u043d\u044c \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f:"),_.a.createElement("p",null,this.state.profileInfo.birthday||"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e")),_.a.createElement("div",{className:"default_block__item"},_.a.createElement("h2",null,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d:"),_.a.createElement("p",null,this.state.profileInfo.tel||"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e")))),_.a.createElement("div",{className:"profile__posts"},_.a.createElement(k.a,{buttonMessage:"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c",placeholder:"\u0427\u0442\u043e \u0443 \u0412\u0430\u0441 \u043d\u043e\u0432\u043e\u0433\u043e?",onSend:this.addNewPost}),Array.isArray(this.state.posts)&&this.state.posts.map((function(t){return _.a.createElement(_.a.Fragment,null,_.a.createElement(D,Object.assign({key:t.path,updatePostLike:e.updatePostLike,postNewLikeState:e.postNewLikeState,deletePost:e.deletePost,myId:e.myId},t)))}))),_.a.createElement("div",{className:"profile__sidebar__right"},_.a.createElement("div",{className:"default_block"},_.a.createElement("h1",{className:"default_block__header"},"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0444\u043e\u0442\u043e"),_.a.createElement("div",{className:"profile_gallery__container"},Array.isArray(this.state.profileInfo.images_list)&&this.state.profileInfo.images_list.map((function(e,t){return _.a.createElement("img",{key:t,className:"profile_gallery__item",src:A.b+A.a+"/gallery_storage".concat(Object(j.a)(e),"/img.jpg"),alt:""})})))))))}}]),a}(_.a.Component),D=Object(d.memo)((function(e){var t=e.updatePostLike,a=e.postNewLikeState,c=e.deletePost,o=Object(n.a)(e,["updatePostLike","postNewLikeState","deletePost"]),m=Object(d.useState)([]),u=Object(s.a)(m,2),p=u[0],f=u[1],b=Object(d.useState)(!1),v=Object(s.a)(b,2),O=v[0],N=v[1],y=Object(d.useRef)(),w=function(){var e=Object(l.a)(i.a.mark((function e(t){var a,n,c,l,m,u,d,_,h,b=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b.length>1&&void 0!==b[1]?b[1]:o.path,e.next=3,Object(E.a)(A.b+A.a+"/profile/add_new_object",{text:t,path:a},"POST");case 3:if(n=e.sent,c=Object(s.a)(n,2),l=c[0],m=c[1],null===l){if(u={creation_time:m.creation_time,first_name:"Vladimir",last_name:"Putin",me_liked:!1,auth_id:o.myId,modification_time:null,num_likes:0,path:m.path,text:t,children:[]},0===(a=a.split(".").slice(1).map((function(e){return e-1}))).length)d=[].concat(Object(r.a)(p),[u]);else{for(d=Object(r.a)(p),_=d[a[0]],h=1;h<a.length;h++)_=_.children[a[h]];_.children.push(u)}f(d)}case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=new g.a(function(){var e=Object(l.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(t,n);case 2:if(!e.sent){e.next=4;break}!function(){var e,t=n.split(".");if(2===t.length)e=p.map((function(e){return e.path===n&&(e.num_likes+=e.me_liked?-1:1,e.me_liked=!e.me_liked),e}));else{for(var a=(e=Object(r.a)(p)).find((function(e){return e.path===t.slice(0,2).join(".")})),c=function(e){a=a.children.find((function(a){return(null===a||void 0===a?void 0:a.path)===t.slice(0,e+1).join(".")}))},i=2;i<t.length;i++)c(i);a.num_likes+=a.me_liked?-1:1,a.me_liked=!a.me_liked}f(e)}();case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),100),S=function(){var e=Object(l.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(A.b+A.a+"/profile/get_comments?path=".concat(o.path,"&lim=",10),{method:"get"});case 3:return t=e.sent,e.next=6,t.json();case 6:return a=e.sent,e.next=9,f(a);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=Object(l.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)(A.b+A.a+"/profile/delete_object",null,"POST","text",o.path);case 2:t=e.sent,a=Object(s.a)(t,1),null===a[0]&&c(o.path);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O&&Object(E.a)(A.b+A.a+"/profile/update_object_text",null,"POST","text",JSON.stringify({Path:o.path,Text:y.current.innerText})),N(!O);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(e){var t,a=e.split(".");if(2===a.length)t=p.filter((function(t){return t.path!==e}));else{for(var n=(t=Object(r.a)(p)).find((function(e){return e.path===a.slice(0,2).join(".")})),c=function(e){n=n.children.find((function(t){return(null===t||void 0===t?void 0:t.path)===a.slice(0,e+1).join(".")}))},i=2;i<a.length-1;i++)c(i);n.children=n.children.filter((function(t){return t.path!==e}))}f(t)};return _.a.createElement("div",{className:"record post"},_.a.createElement("div",{className:"record__header"},_.a.createElement(h.a,{src:A.b+A.a+"/profile_bgs".concat(Object(j.a)(o.auth_id),"/profile_avatar.jpg"),name:o.first_name+" "+o.last_name,description:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d: ".concat(o.creation_time)+(o.modification_time?" \u0438\u0437\u043c\u0435\u043d\u0435\u043d: ".concat(o.modification_time):"")})),_.a.createElement("div",{className:"record__text",contentEditable:O,ref:y},o.text),_.a.createElement("div",{className:"record__footer"},_.a.createElement("div",{className:"footer_item likes"},_.a.createElement("button",{type:"button",className:"footer_icon default_img ".concat(o.me_liked?"liked_pic":"not_liked_pic"),onClick:function(){t(o.me_liked,o.path)}}),_.a.createElement("p",null,o.num_likes)),_.a.createElement("div",{className:"footer_item comments"},_.a.createElement("button",{type:"button",onClick:S,className:"footer_icon default_img comments_pic"}),_.a.createElement("p",null,o.num_comments,"+")),o.myId===o.auth_id&&_.a.createElement("div",{className:"footer_item post_comment__functional"},_.a.createElement("button",{type:"button",className:"footer_icon default_img post_comment_button__edit",onClick:P},O?"\u2713":"\ud83d\udd89"),_.a.createElement("button",{type:"button",className:"footer_icon default_img post_comment_button__delete",onClick:I},"\u274c"))),Array.isArray(p)&&p.map((function(e){return _.a.createElement(R,Object.assign({key:e.path,updateCommentLike:x,addNewComment:w,deleteComment:C,myId:o.myId},e))})),_.a.createElement(k.a,{placeholder:"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",buttonMessage:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",onSend:w}))}));function R(e){var t=e.children,a=void 0===t?[]:t,r=e.addNewComment,c=e.updateCommentLike,o=e.deleteComment,m=Object(n.a)(e,["children","addNewComment","updateCommentLike","deleteComment"]),u=Object(d.useState)(!1),p=Object(s.a)(u,2),f=p[0],b=p[1],v=Object(d.useState)(!1),g=Object(s.a)(v,2),O=g[0],N=g[1],y=Object(d.useRef)(),w=function(){var e=Object(l.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)(A.b+A.a+"/profile/delete_object",null,"POST","text",m.path);case 2:t=e.sent,a=Object(s.a)(t,1),null===a[0]&&o(m.path);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O&&Object(E.a)(A.b+A.a+"/profile/update_object_text",null,"POST","text",JSON.stringify({Path:m.path,Text:y.current.innerText})),N(!O);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return _.a.createElement("div",{className:"comment_container",style:{paddingLeft:"10px"}},_.a.createElement("div",{className:"record comment"},_.a.createElement("div",{className:"record__header"},_.a.createElement(h.a,{src:A.b+A.a+"/profile_bgs".concat(Object(j.a)(m.auth_id),"/profile_avatar.jpg"),name:m.first_name+" "+m.last_name,description:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d: ".concat(m.creation_time)+(m.modification_time?" \u0438\u0437\u043c\u0435\u043d\u0435\u043d: ".concat(m.modification_time):"")})),_.a.createElement("div",{className:"record__text",ref:y,contentEditable:O},m.text),_.a.createElement("div",{className:"record__footer"},_.a.createElement("div",{className:"footer_item likes"},_.a.createElement("button",{type:"button",onClick:function(){c(m.me_liked,m.path)},className:"footer_icon default_img ".concat(m.me_liked?"liked_pic":"not_liked_pic")}),_.a.createElement("p",null,m.num_likes)),_.a.createElement("div",{className:"footer_item reply",onClick:function(){b(!0)}},_.a.createElement("button",{type:"button",className:"footer_icon default_img reply_pic"})),m.myId===m.auth_id&&_.a.createElement("div",{className:"footer_item post_comment__functional"},_.a.createElement("button",{type:"button",className:"footer_icon default_img post_comment_button__edit",onClick:x},O?"\u2713":"\ud83d\udd89"),_.a.createElement("button",{type:"button",className:"footer_icon default_img post_comment_button__delete",onClick:w},"\u274c"))),f&&_.a.createElement(k.a,{buttonMessage:"\u041e\u0442\u0432\u0435\u0442\u0438\u0442\u044c",onSend:function(e){b(!1),r(e,m.path)}}),a.map((function(e){return e&&_.a.createElement(R,Object.assign({updateCommentLike:c,key:e.path,addNewComment:r,deleteComment:o,myId:m.myId},e))}))))}t.default=Object(v.i)(M)},76:function(e,t,a){"use strict";var n=a(0),r=a.n(n),c=(a(77),a(55),Object(n.memo)((function(e){var t=e.placeholder,a=e.buttonMessage,c=e.onSend,i=Object(n.useRef)(),o=function(e){var t=e.target,a=i.current.value,n=i.current.selectionStart;i.current.value=a.slice(0,n)+t.innerText+a.slice(n,a.length),i.current.focus(),i.current.setSelectionRange(n+2,n+2)};return r.a.createElement("div",{className:"send_new_message__container"},r.a.createElement("textarea",{className:"default_search_input",placeholder:t,ref:i}),r.a.createElement("div",{className:"send_new_message__functional_area"},r.a.createElement("div",{className:"smile_area"},["\ud83d\ude10","\ud83d\ude2b","\ud83d\ude0e","\ud83d\ude02","\ud83d\ude21","\ud83d\ude2d","\ud83d\ude00","\ud83d\ude17","\ud83d\ude32","\ud83d\ude2c"].map((function(e){return r.a.createElement("span",{className:"smile",key:e,role:"img",onClick:o},e)}))),r.a.createElement("button",{className:"add_record__button",onClick:function(){c(i.current.value),i.current.value=""}},a)))})));t.a=c},77:function(e,t,a){},90:function(e,t,a){},91:function(e,t,a){e.exports=a.p+"static/media/f_add.7e42a7ae.ico"},92:function(e,t,a){e.exports=a.p+"static/media/f_friends.1639cc31.ico"},93:function(e,t,a){e.exports=a.p+"static/media/f_req_from.f634f58a.ico"},94:function(e,t,a){e.exports=a.p+"static/media/f_req_to.05fd42bf.ico"}}]);
//# sourceMappingURL=3.9c75c97c.chunk.js.map