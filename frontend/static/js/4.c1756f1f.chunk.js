(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[4],{108:function(e,t,a){"use strict";a.r(t);var n=a(5),c=a.n(n),s=a(25),i=a(15),r=a(19),u=a(9),o=a(10),l=a(17),p=a(12),d=a(11),f=a(0),m=a.n(f),h=(a(89),a(82),a(90),a(38)),_=a(36),b=a(22),M=(a(78),a(21)),v=a(91),g=a.n(v),O=a(3),y=a(20),E=a(23),j=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,o=new Array(n),p=0;p<n;p++)o[p]=arguments[p];return(e=t.call.apply(t,[this].concat(o))).state={UserMusic:[],AllMusic:[],offset:0,searchInputValue:"",isFetching:!1,popupOpen:!1,Done:!1,error:null},e.pageId=+e.props.match.params.id,e.isPageMine=e.props.playerStoreState.userId===e.pageId,e.fetchLimit=20,e.addMusicRef=Object(f.createRef)(),e.myId=+Object(E.a)("userId"),e.handleError=y.c.bind(Object(l.a)(e)),e.handleClose=y.b.bind(Object(l.a)(e)),e.fetchMusic=Object(r.a)(c.a.mark((function t(){var a,n,r,u,o,l,p,d;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.state.offset,n=e.state.searchInputValue,r=O.b+O.a+"/music/".concat(""===n?"get_user_music":"get_combined_music"),u={userId:e.pageId,offset:a,withValue:n,limit:e.fetchLimit},e.setState({isFetching:!0}),t.next=7,Object(b.a)(r,u);case 7:o=t.sent,l=Object(i.a)(o,2),p=l[0],d=l[1],null===p?e.setState((function(t){return{offset:a+e.fetchLimit,UserMusic:[].concat(Object(s.a)(t.UserMusic),Object(s.a)(d.UserMusic)),AllMusic:[].concat(Object(s.a)(t.AllMusic),Object(s.a)(d.AllMusic)),Done:d.Done}})):e.handleError("\u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430"),e.setState({isFetching:!1});case 13:case"end":return t.stop()}}),t)}))),e.fetchInitialMusic=function(){e.setState({offset:0,Done:!1,UserMusic:[],AllMusic:[]},(function(){return e.fetchMusic()}))},e.handleScrollThrottled=Object(_.a)((function(){console.log(e.state.Done,e.state.popupOpen,e.state.isFetching),Math.abs(window.scrollY+window.innerHeight-document.documentElement.scrollHeight)<10&&!e.state.Done&&!e.state.popupOpen&&!e.state.isFetching&&e.fetchMusic()}),1e3),e.fetchInitialMusicDebounced=Object(h.a)((function(){e.setState({UserMusic:[],AllMusic:[],offset:0},(function(){return e.fetchInitialMusic()}))}),500),e.onPopupClose=function(){e.setState({popupOpen:!1})},e.onFileDownloaded=function(){e.addMusicRef.current.files.length&&e.setState({popupOpen:!0})},e.postMusic=function(){var t=Object(r.a)(c.a.mark((function t(a,n){var r,u,o,l,p;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.onPopupClose(),(r=new FormData).append("audio",e.addMusicRef.current.files[0]),t.next=5,Object(b.a)(O.b+O.a+"/music/post_music",{author:a,title:n},"POST","text",r);case 5:u=t.sent,o=Object(i.a)(u,2),l=o[0],p=o[1],null===l?e.setState((function(t){return{UserMusic:[{music_id:p,adder_id:e.myId,author:a,name:n}].concat(Object(s.a)(t.UserMusic)),offset:t.offset+1}})):e.handleError("\u043e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440");case 10:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.addToPlaylistHandler=function(){var t=Object(r.a)(c.a.mark((function t(a){var n,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(b.a)(O.b+O.a+"/music/add_to_playlist",{musicId:a},"POST","text");case 2:n=t.sent,s=Object(i.a)(n,1),null!==s[0]&&e.handleError("\u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \u043c\u0443\u0437\u044b\u043a\u0438 \u0432 \u043f\u043b\u0435\u0439\u043b\u0438\u0441\u0442");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.deleteMusic=function(){var t=Object(r.a)(c.a.mark((function t(a){var n,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(b.a)(O.b+O.a+"/music/remove_music",{musicId:a},"GET","text");case 2:n=t.sent,s=Object(i.a)(n,1),null===s[0]?e.setState((function(t){return{offset:e.offset-1,UserMusic:t.UserMusic.filter((function(e){return e.music_id!==a}))}})):e.handleError("\u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u043c\u0443\u0437\u044b\u043a\u0438");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.playUserMusicHandler=function(t){e.props.updatePlayerStoreState({playlist:e.state.UserMusic,trackIndex:t,done:!1,playlistName:"UserMusic",withValue:e.state.searchInputValue,userId:e.pageId})},e.playAllMusicHandler=function(t){e.props.updatePlayerStoreState({playlist:e.state.AllMusic,trackIndex:t,done:!1,playlistName:"AllMusic",withValue:e.state.searchInputValue,userId:e.pageId})},e.onInputChange=function(t){e.setState({searchInputValue:t.target.value}),e.fetchInitialMusicDebounced()},e}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.fetchInitialMusic(),window.addEventListener("scroll",this.handleScrollThrottled,!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScrollThrottled)}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;e!==this.props&&(this.pageId=+this.props.match.params.id,this.setState({UserMusic:[],AllMusic:[],offset:0,searchInputValue:"",isFetching:!1,popupOpen:!1,Done:!1,error:null},(function(){return n.fetchInitialMusic()})))}},{key:"render",value:function(){var e=this;return m.a.createElement("div",{className:"page__container"},this.state.error&&m.a.createElement(y.a,{text:this.state.error,handleClose:this.handleClose}),m.a.createElement("div",{className:"page__header background_pic__city background_pic__city_green"},m.a.createElement("h1",{style:{color:"white"}},"\u041c\u0443\u0437\u044b\u043a\u0430"),m.a.createElement("p",{style:{color:"white"}},"\u0417\u0434\u0435\u0441\u044c \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0441\u043b\u0443\u0448\u0430\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443"),m.a.createElement("div",{className:"audio_foreground_pic default_img"})),m.a.createElement("div",{className:"VA_func_block"},m.a.createElement("input",{className:"default_search_input",placeholder:"\u041f\u043e\u0438\u0441\u043a \u043c\u0443\u0437\u044b\u043a\u0438",value:this.state.searchInputValue,onChange:this.onInputChange}),m.a.createElement("input",{type:"file",className:"hidden_input",id:"select_audio_file__input",accept:"audio/*",ref:this.addMusicRef,onChange:this.onFileDownloaded}),m.a.createElement("label",{htmlFor:"select_audio_file__input"},"+")),this.state.UserMusic.map((function(t,a){return m.a.createElement(I,{key:t.music_id,offset:a,playMusicHandler:e.playUserMusicHandler,deleteMusicHandler:e.deleteMusic,name:t.name,author:t.author,music_id:t.music_id,isPageMine:e.isPageMine})})),this.state.AllMusic.length?m.a.createElement("div",null,"\u0412\u0441\u0435 \u0430\u0443\u0434\u0438\u043e\u0437\u0430\u043f\u0438\u0441\u0438"):null,this.state.AllMusic.map((function(t,a){return m.a.createElement(I,{key:t.music_id,offset:a,name:t.name,author:t.author,music_id:t.music_id,playMusicHandler:e.playAllMusicHandler,addToPlaylistHandler:e.addToPlaylistHandler})})),this.state.isFetching&&m.a.createElement("span",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."),this.state.popupOpen&&m.a.createElement(w,{onClose:this.onPopupClose,_onSend:this.postMusic}))}}]),a}(m.a.Component),I=Object(f.memo)((function(e){var t=e.isPageMine,a=e.playMusicHandler,n=e.deleteMusicHandler,c=e.offset,s=e.name,r=e.author,u=e.music_id,o=e.addToPlaylistHandler,l=Object(f.useState)(!0),p=Object(i.a)(l,2),d=p[0],h=p[1];return m.a.createElement("div",{className:"audio_track",onClick:function(){a(c)}},m.a.createElement("div",{className:"audio_info"},m.a.createElement("img",{className:"audio_cover",src:g.a,alt:" "}),m.a.createElement("span",{className:"audio_track__name"},s),m.a.createElement("span",{className:"audio_track__author"},r)),t?m.a.createElement("div",null,m.a.createElement("button",{className:"audio__button audio__button-delete",onClick:function(e){e.stopPropagation(),n(u)}},"\u274c")):m.a.createElement("div",null,m.a.createElement("button",{className:"audio__button audio__button-add",onClick:function(e){e.stopPropagation(),o(u),h(!1)},disabled:!d},d?"+":"\u2713")))}));function w(e){var t=e.onClose,a=e._onSend,n=Object(f.useState)(""),c=Object(i.a)(n,2),s=c[0],r=c[1],u=Object(f.useState)(""),o=Object(i.a)(u,2),l=o[0],p=o[1];return m.a.createElement("div",{className:"b-popup"},m.a.createElement("div",{className:"b-popup-content"},m.a.createElement("button",{className:"popup_button__close",onClick:t},"\xd7"),m.a.createElement("input",{placeholder:"\u0410\u0432\u0442\u043e\u0440",value:s,onChange:function(e){var t=e.target;r(t.value)}}),m.a.createElement("input",{placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",value:l,onChange:function(e){var t=e.target;p(t.value)}}),m.a.createElement("button",{className:"popup_button__action",onClick:function(){a(s,l)}},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c")))}t.default=Object(M.i)(j)},78:function(e,t,a){},82:function(e,t,a){},89:function(e,t,a){},90:function(e,t,a){},91:function(e,t,a){e.exports=a.p+"static/media/track_cover.384858af.ico"}}]);
//# sourceMappingURL=4.c1756f1f.chunk.js.map