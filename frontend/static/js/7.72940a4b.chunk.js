(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[7],{104:function(e,t,a){"use strict";a.r(t);var n=a(5),r=a.n(n),i=a(25),c=a(15),s=a(19),l=a(9),o=a(10),d=a(17),m=a(12),u=a(11),g=a(0),h=a.n(g),f=(a(85),a(22)),p=a(36),_=(a(57),a(26)),I=a(21),b=a(3),y=(a(78),a(20)),v=a(23),j=function(e){Object(m.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,o=new Array(n),m=0;m<n;m++)o[m]=arguments[m];return(e=t.call.apply(t,[this].concat(o))).addImageRef=Object(g.createRef)(),e.fetchLimit=20,e.pageId=+e.props.match.params.id,e.myId=+Object(v.a)("userId"),e.state={ImagesList:[],offset:0,isFetching:!1,Done:!1,error:null},e.handleError=y.c.bind(Object(d.a)(e)),e.handleClose=y.b.bind(Object(d.a)(e)),e.fetchImages=function(){var t=Object(s.a)(r.a.mark((function t(a){var n,s,l,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState((function(){return{isFetching:!0}})),t.next=3,Object(f.a)(b.b+b.a+"/gallery/get_images",{limit:a,startFrom:e.state.offset,userId:e.pageId});case 3:n=t.sent,s=Object(c.a)(n,2),l=s[0],o=s[1],null===l?e.setState((function(e){return{offset:e.offset+a,ImagesList:[].concat(Object(i.a)(e.ImagesList),Object(i.a)(o.ImagesList)),Done:o.Done}})):e.handleError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430"),e.setState((function(){return{isFetching:!1}}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleScrollThrottled=Object(p.a)((function(){Math.round(window.scrollY+window.innerHeight)!==document.documentElement.scrollHeight||e.state.Done||e.state.isFetching||e.fetchImages(e.fetchLimit)}),1e3),e.postImageHandler=Object(s.a)(r.a.mark((function t(){var a,n,s,l,o,d;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.addImageRef.current.files.length){t.next=10;break}return(a=new FormData).append("image",e.addImageRef.current.files[0]),t.next=5,Object(f.a)(b.b+b.a+"/gallery/post_image",{},"post","text",a);case 5:n=t.sent,s=Object(c.a)(n,2),l=s[0],o=s[1],null===l?(d=+o,e.setState((function(t){return{ImagesList:[{image_id:d,adder_id:e.myId}].concat(Object(i.a)(t.ImagesList)),offset:t.offset+1}}))):e.handleError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435");case 10:case"end":return t.stop()}}),t)}))),e.addImageToMyGalleryHandler=function(){var t=Object(s.a)(r.a.mark((function t(a){var n,i,s,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=b.b+b.a+"/gallery/add_to_my_gallery",i={imageId:a},t.next=4,Object(f.a)(n,i,"Post","text");case 4:s=t.sent,l=Object(c.a)(s,1),null!==l[0]&&e.handleError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0432 \u0432\u0430\u0448\u0443 \u0433\u0430\u043b\u0435\u0440\u0435\u044e");case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.deleteImageHandler=function(){var t=Object(s.a)(r.a.mark((function t(a){var n,i,s,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=b.b+b.a+"/gallery/delete_image",i={imageId:a},t.next=4,Object(f.a)(n,i,"GET","text");case 4:s=t.sent,l=Object(c.a)(s,1),null===l[0]?e.setState((function(e){return{offset:e.offset-1,ImagesList:e.ImagesList.filter((function(e){return e.image_id!==a}))}})):e.handleError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435");case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this.pageId===this.myId?this.fetchLimit-1:this.fetchLimit;this.fetchImages(e),window.addEventListener("scroll",this.handleScrollThrottled,!0)}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;if(e!==this.props){var r=this.pageId===this.myId?this.fetchLimit-1:this.fetchLimit;this.pageId=+this.props.match.params.id,this.setState({ImagesList:[],offset:0,isFetching:!1,Done:!1,error:null},(function(){return n.fetchImages(r)}))}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScrollThrottled)}},{key:"render",value:function(){var e=this;return h.a.createElement("div",{className:"page__container"},h.a.createElement("div",{className:"page__header background_pic__city background_pic__city_purple"},h.a.createElement("h1",{style:{color:"white"}},"\u0424\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438"),h.a.createElement("p",{style:{color:"white"}},"\u0417\u0434\u0435\u0441\u044c \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438"),h.a.createElement("div",{className:"default_img"})),h.a.createElement("div",{className:"gallery__container"},this.pageId===this.myId&&h.a.createElement("div",{className:"gallery__item"},h.a.createElement("input",{type:"file",className:"hidden_input",id:"select_image_file__input",accept:"image/jpeg",ref:this.addImageRef,onChange:this.postImageHandler}),h.a.createElement("label",{className:"gallery__button_add",htmlFor:"select_image_file__input"},"+")),this.state.ImagesList.map((function(t){return h.a.createElement(O,{key:t.image_id,imageId:t.image_id,myId:e.myId,pageId:e.pageId,deleteImageHandler:e.deleteImageHandler,addImageHandler:e.addImageToMyGalleryHandler})}))),this.state.isFetching&&h.a.createElement("span",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."),this.state.error&&h.a.createElement(y.a,{text:this.state.error,handleClose:this.handleClose}))}}]),a}(h.a.Component),O=Object(g.memo)((function(e){var t=e.imageId,a=e.deleteImageHandler,n=e.addImageHandler,r=e.myId,i=e.pageId,s=b.b+b.a+"/gallery_storage"+Object(_.a)(t)+"/img.jpg",l=Object(g.useState)(!1),o=Object(c.a)(l,2),d=o[0],m=o[1];return h.a.createElement("div",{className:"gallery__item"},h.a.createElement("img",{className:"gallery__photo ".concat(d?"photo__expanded":null),src:s,onClick:function(){m(!d)},alt:" "}),d&&(i===r?h.a.createElement("button",{className:"gallery__button gallery_delete_photo_button",onClick:function(){m(!1),a(t)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"):h.a.createElement("button",{className:"gallery__button gallery_delete_photo_button",onClick:function(){n(t)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c")))}));t.default=Object(I.i)(j)},78:function(e,t,a){},85:function(e,t,a){}}]);
//# sourceMappingURL=7.72940a4b.chunk.js.map