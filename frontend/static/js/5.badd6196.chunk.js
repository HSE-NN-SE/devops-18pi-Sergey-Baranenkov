(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[5],{107:function(e,t,n){"use strict";n.r(t);var a=n(5),o=n.n(a),i=n(25),s=n(15),c=n(19),r=n(9),l=n(10),d=n(17),u=n(12),p=n(11),f=n(0),h=n.n(f),m=(n(89),n(58),n(82),n(78),n(83),n(6)),v=n(21),b=n(22),_=n(38),O=n(36),V=n(23),g=n(26),E=n(3),j=n(20),I=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];return(e=t.call.apply(t,[this].concat(l))).state={UserVideos:[],AllVideos:[],offset:0,searchInputValue:"",isFetching:!1,popupOpen:!1,Done:!1,error:null},e.pageId=+e.props.match.params.id,e.isPageMine=+Object(V.a)("userId")===e.pageId,e.fetchLimit=16,e.addVideoRef=Object(f.createRef)(),e.handleError=j.c.bind(Object(d.a)(e)),e.handleClose=j.b.bind(Object(d.a)(e)),e.fetchVideo=Object(c.a)(o.a.mark((function t(){var n,a,c,r,l,d,u,p;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.state.offset,a=e.state.searchInputValue,c=E.b+E.a+"/video/".concat(""===a?"get_user_video":"get_combined_video"),r={userId:e.pageId,offset:n,withValue:a,limit:e.fetchLimit},e.setState({isFetching:!0}),t.next=7,Object(b.a)(c,r);case 7:l=t.sent,d=Object(s.a)(l,2),u=d[0],p=d[1],null===u?e.setState((function(t){return{offset:n+e.fetchLimit,UserVideos:[].concat(Object(i.a)(t.UserVideos),Object(i.a)(p.UserVideos)),AllVideos:[].concat(Object(i.a)(t.AllVideos),Object(i.a)(p.AllVideos)),Done:p.Done}})):e.handleError("\u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430"),e.setState({isFetching:!1});case 13:case"end":return t.stop()}}),t)}))),e.fetchInitialVideos=function(){e.setState({offset:0,Done:!1,UserVideos:[],AllVideos:[]},(function(){return e.fetchVideo()}))},e.handleScrollThrottled=Object(O.a)((function(){Math.abs(window.scrollY+window.innerHeight-document.documentElement.scrollHeight)<10&&!e.state.Done&&!e.state.popupOpen&&!e.state.isFetching&&e.fetchVideo()}),1e3),e.fetchInitialVideosDebounced=Object(_.a)((function(){e.setState({UserVideos:[],AllVideos:[],offset:0},(function(){return e.fetchInitialVideos()}))}),500),e.onPopupClose=function(){e.setState({popupOpen:!1})},e.onFileDownloaded=function(){e.addVideoRef.current.files.length&&e.setState({popupOpen:!0})},e.postVideo=function(){var t=Object(c.a)(o.a.mark((function t(n){var a,c,r,l,d;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.onPopupClose(),(a=new FormData).append("video",e.addVideoRef.current.files[0]),t.next=5,Object(b.a)(E.b+E.a+"/video/post_video",{title:n},"POST","text",a);case 5:c=t.sent,r=Object(s.a)(c,2),l=r[0],d=r[1],null===l?e.setState((function(t){return{UserVideos:[{video_id:+d,adder_id:e.myId,name:n}].concat(Object(i.a)(t.UserVideos)),offset:t.offset+1}})):e.handleError("\u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440");case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.addToPlaylistHandler=function(){var t=Object(c.a)(o.a.mark((function t(n){var a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(b.a)(E.b+E.a+"/video/add_to_playlist",{videoId:n},"POST","text");case 2:a=t.sent,i=Object(s.a)(a,1),null!==i[0]&&e.handleError("\u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e \u0432 \u043f\u043b\u0435\u0439\u043b\u0438\u0441\u0442");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.deleteVideo=function(){var t=Object(c.a)(o.a.mark((function t(n){var a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(b.a)(E.b+E.a+"/video/remove_video",{videoId:n},"GET","text");case 2:a=t.sent,i=Object(s.a)(a,1),null===i[0]?e.setState((function(t){return{offset:e.offset-1,UserVideos:t.UserVideos.filter((function(e){return e.video_id!==n}))}})):e.handleError("\u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e \u0438\u0437 \u043f\u043b\u0435\u0439\u043b\u0438\u0441\u0442\u0430");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onInputChange=function(t){e.setState({searchInputValue:t.target.value}),e.fetchInitialVideosDebounced()},e}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){var a=this;e!==this.props&&(this.pageId=+this.props.match.params.id,this.isPageMine=+Object(V.a)("userId")===this.pageId,this.setState({UserVideos:[],AllVideos:[],offset:0,searchInputValue:"",isFetching:!1,popupOpen:!1,Done:!1,error:null},(function(){return a.fetchInitialVideos()})))}},{key:"componentDidMount",value:function(){this.fetchInitialVideos(),window.addEventListener("scroll",this.handleScrollThrottled,!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScrollThrottled)}},{key:"render",value:function(){var e=this;return h.a.createElement("div",{className:"page__container"},h.a.createElement("div",{className:"page__header background_pic__city background_pic__city_blue"},h.a.createElement("h1",{style:{color:"white"}},"\u0412\u0438\u0434\u0435\u043e"),h.a.createElement("p",{style:{color:"white"}},"\u0417\u0434\u0435\u0441\u044c \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0432\u0438\u0434\u0435\u043e"),h.a.createElement("div",{className:"video_foreground_pic default_img"})),h.a.createElement("div",{className:"VA_func_block"},h.a.createElement("input",{className:"default_search_input",placeholder:"\u041f\u043e\u0438\u0441\u043a \u0432\u0438\u0434\u0435\u043e",onChange:this.onInputChange}),h.a.createElement("input",{type:"file",className:"hidden_input",id:"select_video_file__input",accept:"video/*",onChange:this.onFileDownloaded,ref:this.addVideoRef}),this.isPageMine&&h.a.createElement("label",{htmlFor:"select_video_file__input"},"+")),h.a.createElement("div",{className:"videos__container"},this.state.UserVideos.map((function(t){return h.a.createElement(w,{key:t.video_id,about:t,isPageMine:e.isPageMine,videoId:t.video_id,deleteMusicHandler:e.deleteVideo})}))),Boolean(this.state.AllVideos.length)&&h.a.createElement("span",null,"\u0412\u0441\u0435 \u0432\u0438\u0434\u0435\u043e"),h.a.createElement("div",{className:"videos__container"},this.state.AllVideos.map((function(t){return h.a.createElement(w,{key:t.video_id,about:t,videoId:t.video_id,addToPlaylistHandler:e.addToPlaylistHandler})}))),this.state.isFetching&&h.a.createElement("span",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."),this.state.popupOpen&&h.a.createElement(y,{onClose:this.onPopupClose,_onSend:this.postVideo}),this.state.error&&h.a.createElement(j.a,{text:this.state.error,handleClose:this.handleClose}))}}]),n}(h.a.Component);function w(e){var t=e.about,n=e.isPageMine,a=e.videoId,o=e.addToPlaylistHandler,i=e.deleteMusicHandler,c=Object(f.useState)(!0),r=Object(s.a)(c,2),l=r[0],d=r[1],u=Object(f.useState)(!1),p=Object(s.a)(u,2),v=p[0],b=p[1],_=function(){b(!0)},O=function(){b(!1)};return h.a.createElement("div",{className:"video__container"},h.a.createElement("div",{className:"video__header"},h.a.createElement("span",{className:"video_name"},t.name)),h.a.createElement("video",{tabIndex:0,onFocus:_,onBlur:O,onMouseEnter:_,onMouseLeave:O,className:"video",src:E.b+E.a+"/video_storage".concat(Object(g.a)(t.video_id),"/video.mp4"),preload:"metadata",controls:v}),h.a.createElement("span",{className:"video_functional"},n?h.a.createElement("button",{onClick:function(e){e.stopPropagation(),i(a)}},"-"):h.a.createElement("button",{disabled:!l,onClick:function(e){e.stopPropagation(),o(a),d(!1)}},l?"+":"\u2713"),h.a.createElement(m.c,{to:"/\u043f\u0440\u043e\u0444\u0438\u043b\u044c/".concat(t.adder_id)},"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0430\u0432\u0442\u043e\u0440\u0430 \u21e2")))}function y(e){var t=e.onClose,n=e._onSend,a=Object(f.useState)(""),o=Object(s.a)(a,2),i=o[0],c=o[1];return h.a.createElement("div",{className:"b-popup"},h.a.createElement("div",{className:"b-popup-content"},h.a.createElement("button",{className:"popup_button__close",onClick:t},"\xd7"),h.a.createElement("input",{placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",value:i,onChange:function(e){var t=e.target;c(t.value)}}),h.a.createElement("button",{className:"popup_button__action",onClick:function(){n(i)}},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c")))}t.default=Object(v.i)(I)},78:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},89:function(e,t,n){}}]);
//# sourceMappingURL=5.badd6196.chunk.js.map