{"version":3,"sources":["components/friends/FriendsPage.js"],"names":["FriendsPage","state","error","handleError","bind","handleClose","className","style","color","RelationClassifierLink","to","this","props","match","params","id","label","path","render","Relationships","type","text","React","Component","activeOnlyWhenExact","useRouteMatch","exact","backgroundColor","people","offset","isFetching","Done","limit","handleScrollThrottled","Throttle","Math","abs","window","scrollY","innerHeight","document","documentElement","scrollHeight","fetchData","a","setState","Fetcher","HTTP","ADDR","userId","mode","response","s","People","onAction","query","prevRelType","filter","person","user_id","prevProps","prevState","snapshot","addEventListener","removeEventListener","map","Relationship","key","alt","src","PathFromIdGenerator","first_name","last_name","pathname","onClick","withRouter"],"mappings":"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","file":"static/js/10.abce2a3f.chunk.js","sourcesContent":["import React from \"react\";\nimport \"../../scss/page.scss\";\nimport \"./friends_page.scss\";\nimport PathFromIdGenerator from \"../../functools/PathFromIdGenerator\";\nimport \"../../scss/default_blocks.scss\";\nimport {HTTP, ADDR} from \"../../address\";\nimport {Link, Route, Switch, useRouteMatch, withRouter} from 'react-router-dom';\nimport Fetcher from \"../../functools/Fetcher\";\nimport InfoPopup, {handleError, handleClose} from \"../infoPopup/infoPopup\";\nimport Throttle from \"../../functools/Trottle\";\n\nclass FriendsPage extends React.Component{\n    state = {error: null};\n    handleError = handleError.bind(this);\n    handleClose = handleClose.bind(this);\n    render(){\n        return (\n            <div className={\"page__container\"}>\n                <div className={\"page__header background_pic__city background_pic__city_green\"}>\n                    <h1 style={{color: \"white\"}}>Друзья</h1>\n                    <p style={{color:  \"white\"}}>Здесь находится список друзей</p>\n                    <div className={\"friends_foreground_pic default_img\"}/>\n                </div>\n                <div className={\"friends_classifier__container\"}>\n                    <RelationClassifierLink\n                        to={`/связи/${this.props.match.params.id}/друзья`}\n                        label={\"Друзья\"}\n                    />\n                    <RelationClassifierLink\n                        to={`/связи/${this.props.match.params.id}/подписчики`}\n                        label={\"Подписчики\"}\n                    />\n                    <RelationClassifierLink\n                        to={`/связи/${this.props.match.params.id}/подписки`}\n                        label={\"Подписки\"}\n                    />\n                </div>\n                <Switch>\n                    <Route path=\"/связи/:id/друзья\" render={props => <Relationships type={3} handleError={this.handleError} {...props}/>}/>\n                    <Route path=\"/связи/:id/подписчики\" render={props => <Relationships type = {2} handleError={this.handleError} {...props}/>}/>\n                    <Route path=\"/связи/:id/подписки\" render = {props => <Relationships type ={1} handleError={this.handleError} {...props}/>}/>\n                </Switch>\n                {this.state.error && <InfoPopup text = {this.state.error} handleClose = {this.handleClose}/>}\n            </div>\n        )\n    }\n}\n\nfunction RelationClassifierLink({ label, to, activeOnlyWhenExact}) {\n    const match = useRouteMatch({\n        path: to,\n        exact: activeOnlyWhenExact\n    });\n    const style = {color: \"white\"}\n    if (match) style.backgroundColor = \"orange\";\n    return (\n        <Link style={style}\n              className={`default_link friends_classifier__item`}\n              to={to}>\n            {label}\n        </Link>\n    );\n}\n\n\n\nclass Relationships extends React.Component{\n    state = {\n        people: [],\n        offset: 0,\n        isFetching: false,\n        Done: false,\n    }\n    limit = 15;\n\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (prevProps.type !== this.props.type){\n            this.setState({people:[], offset:0, Done: false}, ()=>{\n                this.fetchData();\n            })\n        }\n    }\n\n    componentDidMount() {\n        this.fetchData();\n        window.addEventListener('scroll', this.handleScrollThrottled, true);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('scroll', this.handleScrollThrottled);\n    }\n\n    handleScrollThrottled = Throttle(()=>{\n        if ((Math.abs(window.scrollY + window.innerHeight - document.documentElement.scrollHeight) < 10)\n            &&\n            !this.state.Done\n            &&\n            !this.state.isFetching\n        ){\n            this.fetchData();\n        }\n    }, 1000 )\n\n    fetchData = async ()=>{\n        this.setState({isFetching: true});\n        const [error, response] = await Fetcher(HTTP + ADDR + \"/relations/get_relations\",\n            {userId:this.props.match.params.id, mode: this.props.type, limit: this.limit, offset: this.state.offset}\n\n            );\n        if (error === null){\n            this.setState(s => ({people: [...s.people, ...response.People], offset: s.offset + this.limit, Done: response.Done}));\n        }else{\n            this.props.handleError(\"невозможно получить данные с сервера\");\n        }\n        this.setState({isFetching: false});\n    }\n\n    onAction = async (userId) => {\n        const query = HTTP + ADDR + \"/relations/update_relationship\";\n        const [error] = await Fetcher(query, {prevRelType : this.props.type, userId}, \"POST\",\"text\");\n        if (error === null){\n            this.setState(s => ({people: s.people.filter(person => person.user_id!==userId), offset: s.offset - 1}));\n        }else {\n            this.props.handleError(\"невозможно обновить связь\");\n        }\n    }\n\n    render() {\n        return (\n            <>\n                {this.state.people.map( person =>\n                    <Relationship\n                        key = {person.user_id}\n                        {...person}\n                        type = {this.props.type}\n                        onAction={this.onAction}\n                    />\n                )}\n                {this.state.isFetching && <span>Загрузка...</span>}\n            </>\n        )\n    }\n}\n\nfunction Relationship(props) {\n    const onAction = ()=>{\n        props.onAction (props.user_id);\n    }\n\n    return (\n        <div className={\"rel__container\"}>\n            <img className={\"default_img rel_user__avatar\"} alt = \" \" src={\n                HTTP + ADDR + `/profile_bgs${PathFromIdGenerator(props.user_id)}/profile_avatar.jpg`\n            }\n            />\n            <div className={\"rel_user__vertical\"}>\n                <span className={\"rel_user__fullname\"}>{`${props.first_name} ${props.last_name}`}</span>\n                <Link className={\"rel_user__send_mes\"} to = {{\n                    pathname: '/сообщения/',\n                    user_id: props.user_id,\n                    first_name: props.first_name,\n                    last_name: props.last_name\n                }}>Написать сообщение</Link>\n\n            </div>\n            <div className={\"rel__functional\"}>\n                {   (props.type === 3 || props.type === 1)\n                    &&\n                    <button className={\"rel__button delete_friend__button\"} onClick={onAction}>❌</button>\n                }\n                {  props.type === 2\n                    &&\n                    <button className={\"rel__button add_friend__button\"} onClick={onAction}>+</button>\n                }\n            </div>\n        </div>\n    )\n}\n\nexport default withRouter(FriendsPage);"],"sourceRoot":""}